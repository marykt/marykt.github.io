<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>全志h3 开发 | 小边的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="主线内核编译1.编译内核：和U-boot编译类似，进入内核主线目录下输入make ARCH&#x3D;arm CROSS_COMPILE&#x3D;arm-linux-gnueabihf- sun8iw7p1smp_defconfig1生成配置文件接着输入：make ARCH&#x3D;arm CROSS_COMPILE&#x3D;arm-linux-gnueabihf-1CPU高级的记得加上-j">
<meta property="og:type" content="article">
<meta property="og:title" content="全志h3 开发">
<meta property="og:url" content="http://yoursite.com/2022/06/05/linux/%E5%85%A8%E5%BF%97h3%20%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="小边的博客">
<meta property="og:description" content="主线内核编译1.编译内核：和U-boot编译类似，进入内核主线目录下输入make ARCH&#x3D;arm CROSS_COMPILE&#x3D;arm-linux-gnueabihf- sun8iw7p1smp_defconfig1生成配置文件接着输入：make ARCH&#x3D;arm CROSS_COMPILE&#x3D;arm-linux-gnueabihf-1CPU高级的记得加上-j">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-06-05T10:00:00.000Z">
<meta property="article:modified_time" content="2025-01-31T12:59:27.000Z">
<meta property="article:author" content="marykt">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="嵌入式">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="小边的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <!--<link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">-->
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">小边的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">历史文章</a>
        
        
          <a class="main-nav-link" target="_blank" href="https://marykt.top:9001">我的网盘</a>
        
          <a class="main-nav-link" target="_blank" href="https://marykt.top:9003">gitea</a>
        
          <a class="main-nav-link" target="_blank" href="https://marykt.top:9048">chatAI(llama2-chinese)</a>
        
          <a class="main-nav-link" target="_blank" href="https://marykt.top:9047">drawAI(Stable-diffusion)</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-linux/全志h3 开发" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/06/05/linux/%E5%85%A8%E5%BF%97h3%20%E5%BC%80%E5%8F%91/" class="article-date">
  <time datetime="2022-06-05T10:00:00.000Z" itemprop="datePublished">2022-06-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      全志h3 开发
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="主线内核编译"><a href="#主线内核编译" class="headerlink" title="主线内核编译"></a>主线内核编译</h1><p>1.编译内核：<br>和U-boot编译类似，<br>进入内核主线目录下输入<br>make ARCH&#x3D;arm CROSS_COMPILE&#x3D;arm-linux-gnueabihf- sun8iw7p1smp_defconfig<br>1<br>生成配置文件<br>接着输入：<br>make ARCH&#x3D;arm CROSS_COMPILE&#x3D;arm-linux-gnueabihf-<br>1<br>CPU高级的记得加上-j<br>编译完成后在	&#x2F;home&#x2F;mainline&#x2F;mainline_kernel&#x2F;arch&#x2F;arm&#x2F;boot<br>zImage，这是我们内核目标文件，还需要处理一下，先不管。<br>接着输入：<br>make ARCH&#x3D;arm CROSS_COMPILE&#x3D;arm-linux-gnueabihf- dtbs<br>编译设备树<br>目标文件在&#x2F;home&#x2F;mainline&#x2F;mainline_kernel&#x2F;arch&#x2F;arm&#x2F;boot&#x2F;dts下<br>sun8i-h3-orangepi-pc-plus.dtb文件<br>再输入<br>mkdir output<br>make ARCH&#x3D;arm CROSS_COMPILE&#x3D;arm-linux-gnueabihf- INSTALL_MOD_PATH&#x3D;&#x2F;home&#x2F;mainline&#x2F;mainline_kernel&#x2F;output modules_install<br>在output文件夹下得到一系列模块文件，先不管<br>至此编译流程结束，再简单处理一下即可烧入至SD中启动香橙派PC_Plus。<br>第一次写博客，操作不熟悉，看的不爽望原谅，接下来会写如何U-boot启动内核和内核的一些配置及坑</p>
<p>4.补充问题及解决方法<br>安装交叉编译器：<br>apt-get install gcc-arm-linux-gnueabihf<br>recipe for target ‘scripts&#x2F;basic&#x2F;fixdep’ failed<br>apt-get install</p>
<p>Python.h: No such file or directory<br>sudo apt-get install python3-dev</p>
<h1 id="烧入内核"><a href="#烧入内核" class="headerlink" title="烧入内核"></a>烧入内核</h1><p>分区不会损坏之前烧入的U-boot,Linux分区从2048块开始，块单位是512B,也就是分区是从2048*0.5KB&#x3D;1MB处开始的，U-boot大小约为450KB,所以不用担心会损坏U-boot文件<br>首先，我们对TF卡进行分区，当然也可以不用分区，十分建议分区，用分区的原因下面再解释<br>输入命令：fdisk 你的tf卡<br>我这里是 :fdisk &#x2F;dev&#x2F;sdb<br>输入：p先查看信息</p>
<p>Disk &#x2F;dev&#x2F;sdb：29.5 GiB，31666995200 字节，61849600 个扇区<br>单元：扇区 &#x2F; 1 * 512 &#x3D; 512 字节<br>扇区大小(逻辑&#x2F;物理)：512 字节 &#x2F; 512 字节<br>I&#x2F;O 大小(最小&#x2F;最佳)：512 字节 &#x2F; 512 字节</p>
<p>再输入：n</p>
<p>分区类型<br>   p   主分区 (0个主分区，0个扩展分区，4空闲)<br>   e   扩展分区 (逻辑分区容器)<br>选择 (默认 p)： p<br>分区号 (1-4, 默认  1): 1<br>第一个扇区 (2048-61849599, 默认 2048): 2048<br>上个扇区，+sectors 或 +size{K,M,G,T,P} (2048-61849599, 默认 61849599):+100M</p>
<p>以此类推，再创建一个10G大小的分区<br>100M用于存储设备树文件和内核<br>10G用于储存根文件系统<br>大小没有特殊要求，设置为100G和1T也可以。<br>接着我们需要格式化分区，100M格式化成FAT,10G格式化为EXT2或3或4</p>
<p>fdisk &#x2F;dev&#x2F;sdb<br>输入：t再选择分区1<br>输入L打印所有可以文件系统格式<br>再输入6，选择FAT16 FAT32都可以<br>我这里另外一个分区默认是ext4,不用管</p>
<p>接着将<br>sun8i-h3-orangepi-pc-plus.dtb和UImage复制进分区1<br>最后拔出内存卡，插入香橙派，老样子插电打开串口。<br>进入U-boot控制台：<br>    输入：<br>        load mmc 0:1 0x43000000 sun8i-h3-orangepi-pc-plus.dtb<br>        load mmc 0:1 0x42000000 uImage<br>        bootm 0x42000000 - 0x43000000<br>    解释一下：load不用多说是加载的意思，mmc 0:1是指从mmc 第0个分区和第一个分区<br>    寻找名字叫sun8i-h3-orangepi-pc-plus.dtb的文件，然后加载到主存位置0x43000000来。<br>    为什么是分区0和分区1看全志手册：全志优先先给TF分配分区，所以是0和1,然后其他的比如EMMC的分区3，4。<br>    bootm的意思大概能猜出来了把，两个地址分别对应内核文件和设备树文件，缺一不可。</p>
<pre><code>上文说过可以不用格式化为FAT，因为只要知道sun8i-h3-orangepi-pc-plus.dtb和uImage地址和文件大小，
同样可以完成加载。

打印：
=&gt; load mmc 0:1 0x42000000 uImage
7933608 bytes read in 357 ms (21.2 MiB/s)
=&gt; load mmc 0:1 0x43000000 sun8i-h3-orangepi-pc-plus.dtb
30640 bytes read in 5 ms (5.8 MiB/s)
=&gt; bootm 0x42000000 - 0x43000000
## Booting kernel from Legacy Image at 42000000 ...
Image Name:   linux-5.3.5+
Image Type:   ARM Linux Kernel Image (uncompressed)
Data Size:    7933544 Bytes = 7.6 MiB
Load Address: 46000000
Entry Point:  46000000
Verifying Checksum ... OK
## Flattened Device Tree blob at 43000000
Booting using the fdt blob at 0x43000000
EHCI failed to shut down host controller.
Loading Kernel Image
Loading Device Tree to 49ff5000, end 49fff7af ... OK

Starting kernel ...
</code></pre>
<p>这里代表内核启动成功了。<br>下面还有一串阿巴阿巴的信息，先不用管，因为我们的根文件系统还没拷贝进去。</p>
<h1 id="根文件系统"><a href="#根文件系统" class="headerlink" title="根文件系统"></a>根文件系统</h1><p><a href="https://blog.csdn.net/qq_40937426/article/details/107553193">https://blog.csdn.net/qq_40937426/article/details/107553193</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2022/06/05/linux/%E5%85%A8%E5%BF%97h3%20%E5%BC%80%E5%8F%91/" data-id="cm6yz33cx000c8zlvhu9qe3q4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag">嵌入式</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/06/05/linux/dtb%E6%96%87%E4%BB%B6/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          kernel文档和邮件列表
        
      </div>
    </a>
  
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/arm64/">arm64</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/%E3%80%8A%E7%B2%BE%E9%80%9Alinux%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E3%80%8B/">《精通linux设备驱动开发》</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux%E5%86%85%E6%A0%B8/">linux内核</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux%E5%86%85%E6%A0%B8/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3linux%E5%86%85%E6%A0%B8%E3%80%8B/">《深入理解linux内核》</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux%E7%BD%91%E7%BB%9C/">linux网络</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux%E7%BD%91%E7%BB%9C/%E3%80%8A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3linux%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95%E3%80%8B/">《深入理解linux网络技术内幕》</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux%E9%A9%B1%E5%8A%A8/">linux驱动</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux%E9%A9%B1%E5%8A%A8/%E3%80%8Alinux%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E6%88%98%E3%80%8B/">《linux驱动开发入门与实战》</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/arm64/" rel="tag">arm64</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/boot/" rel="tag">boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dtb%E6%96%87%E4%BB%B6/" rel="tag">dtb文件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%86%85%E6%A0%B8/" rel="tag">linux内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag">linux嵌入式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E7%BD%91%E7%BB%9C/" rel="tag">linux网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E9%A9%B1%E5%8A%A8/" rel="tag">linux驱动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E6%A0%B8/" rel="tag">内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag">嵌入式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/arm64/" style="font-size: 10px;">arm64</a> <a href="/tags/boot/" style="font-size: 10px;">boot</a> <a href="/tags/dev/" style="font-size: 10px;">dev</a> <a href="/tags/dtb%E6%96%87%E4%BB%B6/" style="font-size: 10px;">dtb文件</a> <a href="/tags/linux/" style="font-size: 18px;">linux</a> <a href="/tags/linux%E5%86%85%E6%A0%B8/" style="font-size: 20px;">linux内核</a> <a href="/tags/linux%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 10px;">linux嵌入式</a> <a href="/tags/linux%E7%BD%91%E7%BB%9C/" style="font-size: 14px;">linux网络</a> <a href="/tags/linux%E9%A9%B1%E5%8A%A8/" style="font-size: 16px;">linux驱动</a> <a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 12px;">内核</a> <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 10px;">嵌入式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">二月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">四月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/02/10/linux/book-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3linux%E5%86%85%E6%A0%B8/static/Readme/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/02/10/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2025/02/10/%E6%B5%8B%E8%AF%95%E6%8F%90%E4%BA%A4/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/02/10/%E7%AC%94%E8%AE%B0%E6%9C%AC%E6%98%BE%E7%A4%BA%E5%B1%8F%E5%88%B6%E4%BD%9C%E6%98%BE%E7%A4%BA%E5%99%A8/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/05/19/linux/book-linux%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E6%88%98/linux%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E6%88%98%E7%9B%AE%E5%BD%95%E7%B4%A2%E5%BC%95/">《linux驱动开发入门与实战》目录索引</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2025 marykt<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">历史文章</a>
  
  
    <a href="https://marykt.top:9001"  target="_blank" class="mobile-nav-link">我的网盘</a>
  
    <a href="https://marykt.top:9003"  target="_blank" class="mobile-nav-link">gitea</a>
  
    <a href="https://marykt.top:9048"  target="_blank" class="mobile-nav-link">chatAI(llama2-chinese)</a>
  
    <a href="https://marykt.top:9047"  target="_blank" class="mobile-nav-link">drawAI(Stable-diffusion)</a>
  
</nav>
    

<script src="/js/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>